# OWASP ModSecurity Core Rule Set (CRS) Setup Configuration
# This file contains the basic setup for OWASP CRS rules

# Basic OWASP CRS inspired rules for the Gateway
# Note: This is a simplified version for demonstration

# SQL Injection Detection (OWASP CRS 942)
SecRule ARGS "@detectSQLi" "id:942100,msg:'SQL Injection Attack Detected via libinjection',severity:CRITICAL,phase:2,block"
SecRule REQUEST_BODY "@detectSQLi" "id:942101,msg:'SQL Injection Attack Detected in Request Body',severity:CRITICAL,phase:2,block"

# XSS Detection (OWASP CRS 941)  
SecRule ARGS "@detectXSS" "id:941100,msg:'XSS Attack Detected via libinjection',severity:CRITICAL,phase:2,block"
SecRule REQUEST_BODY "@detectXSS" "id:941101,msg:'XSS Attack Detected in Request Body',severity:CRITICAL,phase:2,block"

# Protocol Enforcement (OWASP CRS 920)
SecRule REQUEST_HEADERS:Content-Length "@eq 0" "chain,id:920100,msg:'Zero byte request body',severity:ERROR,phase:1"
SecRule REQUEST_METHOD "@rx ^(POST|PUT|PATCH)$" "block"

# HTTP Method Enforcement (OWASP CRS 911)
SecRule REQUEST_METHOD "@rx ^(TRACE|TRACK|DEBUG|OPTIONS)$" "id:911100,msg:'HTTP method is not allowed by policy',severity:WARNING,phase:1,block"

# Scanner Detection (OWASP CRS 913)
SecRule REQUEST_HEADERS:User-Agent "@rx (?i)(nmap|nikto|sqlmap|dirb|dirbuster|wpscan|w3af|masscan|zap|burp)" "id:913100,msg:'Security scanner detected',severity:ERROR,phase:1,block"

# IP Reputation (OWASP CRS 910)
SecRule REQUEST_HEADERS:X-Forwarded-For "@rx (?i)(tor-exit|proxy|vpn)" "id:910100,msg:'Request from suspicious IP',severity:WARNING,phase:1,log"

# Local File Inclusion (OWASP CRS 930)
SecRule REQUEST_URI "@rx (?i)(\.\./){3,}" "id:930100,msg:'Path Traversal Attack (/../ or ..\)',severity:CRITICAL,phase:2,block"
SecRule ARGS "@rx (?i)(etc/passwd|boot\.ini|windows/system32)" "id:930110,msg:'OS File Access Attempt',severity:CRITICAL,phase:2,block"

# Remote File Inclusion (OWASP CRS 931) 
SecRule ARGS "@rx (?i)(https?://|ftp://|ftps://)" "id:931100,msg:'Possible Remote File Inclusion (RFI) Attack',severity:ERROR,phase:2,block"

# Remote Code Execution (OWASP CRS 932)
SecRule ARGS "@rx (?i)(wget|curl|lynx|nc|netcat)" "id:932100,msg:'Remote Command Execution: Unix Command Injection',severity:CRITICAL,phase:2,block"

# PHP Injection (OWASP CRS 933)
SecRule ARGS "@rx (?i)(php://|expect://|data:)" "id:933100,msg:'PHP Injection Attack',severity:CRITICAL,phase:2,block"

# Node.js Injection (OWASP CRS 934)
SecRule ARGS "@rx (?i)(require\s*\(|process\.)" "id:934100,msg:'Node.js Injection Attack',severity:CRITICAL,phase:2,block"

# Java Code Injection (OWASP CRS 944)
SecRule ARGS "@rx (?i)(runtime\s*\.\s*getruntime|processbuilder)" "id:944100,msg:'Java Code Injection Attack',severity:CRITICAL,phase:2,block"

# Session Fixation (OWASP CRS 943)
SecRule ARGS:PHPSESSID "@rx ^[a-zA-Z0-9,\-]{22,40}$" "id:943100,msg:'Possible Session Fixation Attack',severity:WARNING,phase:2,log"

# Common Exceptions (OWASP CRS 905)
# Allow common query parameters
SecRule ARGS:page "@rx ^\d+$" "id:905100,msg:'Numeric page parameter allowed',severity:NOTICE,phase:2,pass"
SecRule ARGS:limit "@rx ^\d+$" "id:905110,msg:'Numeric limit parameter allowed',severity:NOTICE,phase:2,pass"
SecRule ARGS:offset "@rx ^\d+$" "id:905120,msg:'Numeric offset parameter allowed',severity:NOTICE,phase:2,pass"