# Custom Block Rules
# Additional blocking rules specific to your application

# Block known attack patterns
SecRule REQUEST_URI "@rx (?i)(phpinfo|phpmyadmin|adminer|wp-admin)" "id:200001,msg:'Admin panel access attempt',severity:ERROR,phase:2,block"
SecRule REQUEST_URI "@rx (?i)(\.git|\.svn|\.env|backup|dump)" "id:200002,msg:'Sensitive file access attempt',severity:ERROR,phase:2,block"

# Block suspicious query parameters
SecRule ARGS "@rx (?i)(cmd|exec|system|shell_exec|passthru)" "id:200011,msg:'Command execution attempt in parameters',severity:CRITICAL,phase:2,block"
SecRule ARGS "@rx (?i)(eval|base64_decode|gzinflate|str_rot13)" "id:200012,msg:'Code execution attempt in parameters',severity:CRITICAL,phase:2,block"

# Block suspicious headers
SecRule REQUEST_HEADERS:X-Forwarded-For "@rx (?i)(script|javascript|vbscript)" "id:200021,msg:'Malicious X-Forwarded-For header',severity:WARNING,phase:1,block"
SecRule REQUEST_HEADERS:Referer "@rx (?i)(phishing|malware|virus)" "id:200022,msg:'Suspicious referer header',severity:WARNING,phase:1,block"

# Block large POST requests to specific endpoints
SecRule REQUEST_URI "@beginsWith /api/upload" "chain,id:200031,msg:'Large upload attempt',severity:WARNING,phase:2"
SecRule REQUEST_HEADERS:Content-Length "@gt 104857600" "block"

# Block requests with too many parameters (potential DoS)
SecRule ARGS "@count @gt 100" "id:200041,msg:'Too many parameters',severity:WARNING,phase:2,block"

# Block suspicious file extensions in uploads
SecRule REQUEST_BODY "@rx (?i)\.(php|jsp|asp|exe|bat|sh|py|pl|rb)$" "id:200051,msg:'Dangerous file extension in body',severity:ERROR,phase:2,block"

# Block common web shells
SecRule REQUEST_BODY "@rx (?i)(c99|r57|shell|webshell|backdoor)" "id:200061,msg:'Web shell detected',severity:CRITICAL,phase:2,block"

# Block LDAP injection attempts
SecRule ARGS "@rx (?i)(\(|\)|&|\|)(objectclass|cn=|uid=)" "id:200071,msg:'LDAP injection attempt',severity:ERROR,phase:2,block"

# Block XML External Entity (XXE) attacks
SecRule REQUEST_BODY "@rx (?i)<!ENTITY.*?SYSTEM" "id:200081,msg:'XXE attack attempt',severity:CRITICAL,phase:2,block"